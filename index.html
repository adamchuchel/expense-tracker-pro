<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="V√Ωdaje">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">
    <title>üíé V√Ωdaje - Zabezpeƒçen√©</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <!-- Login Screen (shown when not authenticated) -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-logo">üíé</div>
            <h1 class="login-title">V√Ωdaje Pro</h1>
            <p class="login-subtitle">Zabezpeƒçen√° spr√°va skupinov√Ωch financ√≠</p>
            
            <div id="googleSignInButton" class="google-signin-placeholder"></div>
            
            <div class="login-features">
                <div class="feature-item">‚úÖ Skupiny a kategorie</div>
                <div class="feature-item">‚úÖ Multi-mƒõna s ƒåNB kurzy</div>
                <div class="feature-item">‚úÖ Grafy a statistiky</div>
                <div class="feature-item">üîí Zabezpeƒçen√© Google p≈ôihl√°≈°en√≠m</div>
            </div>
        </div>
    </div>

    <!-- Main App (shown when authenticated) -->
    <div id="mainApp" class="app hidden">
        
        <!-- Sidebar Menu -->
        <aside id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-user">
                    <div id="sidebarAvatar" class="sidebar-avatar"></div>
                    <div class="sidebar-user-details">
                        <div id="sidebarUserName" class="sidebar-user-name">User</div>
                        <div id="sidebarUserEmail" class="sidebar-user-email">email@example.com</div>
                    </div>
                </div>
                <button id="closeSidebar" class="close-sidebar">‚úï</button>
            </div>
            
            <nav class="sidebar-content">
                <!-- Main Navigation -->
                <button class="sidebar-item sidebar-nav-item active" data-tab="add">
                    <span class="sidebar-icon">‚ûï</span>
                    <span>P≈ôidat</span>
                </button>
                
                <button class="sidebar-item sidebar-nav-item" data-tab="expenses">
                    <span class="sidebar-icon">üìã</span>
                    <span>V√Ωdaje</span>
                </button>
                
                <button class="sidebar-item sidebar-nav-item" data-tab="balance">
                    <span class="sidebar-icon">üí∞</span>
                    <span>Bilance</span>
                </button>
                
                <button class="sidebar-item sidebar-nav-item" data-tab="stats">
                    <span class="sidebar-icon">üìä</span>
                    <span>Statistiky</span>
                </button>
                
                <button class="sidebar-item sidebar-nav-item" data-tab="invitations">
                    <span class="sidebar-icon">üì¨</span>
                    <span>Pozv√°nky</span>
                </button>
                
                <button class="sidebar-item sidebar-nav-item" data-tab="settings">
                    <span class="sidebar-icon">‚öôÔ∏è</span>
                    <span>Nastaven√≠</span>
                </button>
                
                <div class="sidebar-divider"></div>
                
                <!-- Additional Actions -->
                <button class="sidebar-item" data-action="createGroup">
                    <span class="sidebar-icon">‚ûï</span>
                    <span>Vytvo≈ôit skupinu</span>
                </button>
                
                <button class="sidebar-item" data-action="about">
                    <span class="sidebar-icon">‚ÑπÔ∏è</span>
                    <span>O aplikaci</span>
                </button>
            </nav>
            
            <div class="sidebar-footer">
                <div class="sidebar-org">
                    <div class="sidebar-org-icon">üè¢</div>
                    <div class="sidebar-org-info">
                        <div class="sidebar-org-name">FAMILY</div>
                        <div id="sidebarOrgMembers" class="sidebar-org-members">0 ƒçlen≈Ø</div>
                    </div>
                </div>
                <button class="sidebar-item" id="sidebarLogout">
                    <span class="sidebar-icon">üö™</span>
                    <span>Odhl√°sit se</span>
                </button>
            </div>
        </aside>

        <!-- Sidebar Overlay -->
        <div id="sidebarOverlay" class="sidebar-overlay hidden"></div>
        
        <!-- Fixed Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <button id="openSidebar" class="profile-btn">
                        <div id="headerAvatar" class="header-avatar"></div>
                    </button>
                    <h1>üíé V√Ωdaje</h1>
                    <div class="group-selector" id="groupSelector">
                        <button class="current-group" id="currentGroup">
                            <span id="currentGroupName">V√Ωchoz√≠ skupina</span>
                            <span class="dropdown-icon">‚ñº</span>
                        </button>
                        <div class="group-dropdown hidden" id="groupDropdown">
                            <div class="group-list" id="groupList"></div>
                            <button class="add-group-btn" id="addGroupBtn">+ Nov√° skupina</button>
                        </div>
                    </div>
                </div>
                <div class="header-center">
                    <div id="onlineStatus" class="online-status online">üåê Online</div>
                    <div id="unsyncedBadge" class="unsynced-badge hidden">0 neodeslan√©</div>
                </div>
                <div class="header-right">
                    <button id="syncBtn" class="sync-btn" title="Synchronizovat">
                        <span class="sync-icon">‚ü≥</span>
                    </button>
                    <button id="logoutBtn" class="logout-btn" title="Odhl√°sit se">
                        <span>üë§</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Toast Notifications (z-index 9999) -->
        <div id="toast" class="toast hidden">
            <span id="toastText"></span>
        </div>

        <!-- Fixed Bottom Navigation -->
        <nav class="bottom-nav" style="display: none !important;">
            <button class="nav-btn active" data-tab="add">
                <span class="nav-icon">‚ûï</span>
                <span class="nav-label">P≈ôidat</span>
            </button>
            <button class="nav-btn" data-tab="expenses">
                <span class="nav-icon">üìã</span>
                <span class="nav-label">V√Ωdaje</span>
            </button>
            <button class="nav-btn" data-tab="balance">
                <span class="nav-icon">üí∞</span>
                <span class="nav-label">Bilance</span>
            </button>
            <button class="nav-btn" data-tab="stats">
                <span class="nav-icon">üìä</span>
                <span class="nav-label">Statistiky</span>
            </button>
            <button class="nav-btn" data-tab="invitations">
                <span class="nav-icon">üì¨</span>
                <span class="nav-label">Pozv√°nky</span>
            </button>
            <button class="nav-btn" data-tab="settings">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-label">Nastaven√≠</span>
            </button>
        </nav>

        <!-- Scrollable Content Area -->
        <div class="content-wrapper">
            
            <!-- Add Expense/Income Tab -->
            <div id="addTab" class="tab-content active">
                <div class="toggle-type">
                    <button class="toggle-btn active" data-type="expense">
                        <span class="toggle-icon">üí∏</span>
                        <span>V√Ωdaj</span>
                    </button>
                    <button class="toggle-btn" data-type="income">
                        <span class="toggle-icon">üíµ</span>
                        <span>P≈ô√≠jem</span>
                    </button>
                </div>

                <!-- Expense Form -->
                <form id="expenseForm" class="transaction-form">
                    <div class="form-group">
                        <label for="expenseDescription">Popis</label>
                        <input type="text" id="expenseDescription" placeholder="Nap≈ô. Veƒçe≈ôe v restauraci" required autocomplete="off">
                    </div>

                    <div class="form-group">
                        <label for="expenseAmount">ƒå√°stka (cel√° ƒç√≠sla)</label>
                        <input type="number" id="expenseAmount" placeholder="0" pattern="[0-9]*" inputmode="numeric" required>
                    </div>

                    <div class="form-group">
                        <label for="expenseCurrency">Mƒõna</label>
                        <select id="expenseCurrency">
                            <option value="CZK" selected>CZK</option>
                            <option value="EUR">EUR</option>
                            <option value="USD">USD</option>
                            <option value="GBP">GBP</option>
                            <option value="THB">THB</option>
                            <option value="PLN">PLN</option>
                        </select>
                    </div>

                    <div id="expenseCurrencyNote" class="currency-note hidden">
                        <span id="expenseCurrencyConversion"></span>
                    </div>

                    <div class="form-row">
                        <div class="form-group flex-1">
                            <label for="expenseDate">Datum</label>
                            <input type="date" id="expenseDate" required>
                        </div>
                        <div class="form-group flex-1">
                            <label for="expenseTime">ƒåas</label>
                            <input type="time" id="expenseTime" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="expensePaidBy">Kdo platil</label>
                        <select id="expensePaidBy" required>
                            <option value="">Vyber osobu</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="expenseCategory">Kategorie</label>
                        <select id="expenseCategory" required></select>
                    </div>

                    <div class="form-group">
                        <label>
                            Rozdƒõlit mezi
                            <span class="split-mode-toggle">
                                <button type="button" class="mode-btn active" data-mode="equal">Rovnomƒõrnƒõ</button>
                                <button type="button" class="mode-btn" data-mode="custom">Vlastn√≠</button>
                            </span>
                        </label>
                        <div id="expenseSplitBetween" class="split-container"></div>
                    </div>

                    <div class="form-group">
                        <label for="expenseNote">Pozn√°mka (voliteln√©)</label>
                        <textarea id="expenseNote" placeholder="Dodateƒçn√© informace..." rows="2"></textarea>
                    </div>

                    <button type="submit" class="btn-primary">
                        <span class="btn-icon">üí∏</span>
                        P≈ôidat v√Ωdaj
                    </button>
                </form>

                <!-- Income Form (hidden by default) -->
                <form id="incomeForm" class="transaction-form hidden">
                    <div class="form-group">
                        <label for="incomeDescription">Popis p≈ô√≠jmu</label>
                        <input type="text" id="incomeDescription" placeholder="Nap≈ô. Vr√°cen√≠ penƒõz" required autocomplete="off">
                    </div>

                    <div class="form-group">
                        <label for="incomeAmount">ƒå√°stka (cel√° ƒç√≠sla)</label>
                        <input type="number" id="incomeAmount" placeholder="0" pattern="[0-9]*" inputmode="numeric" required>
                    </div>

                    <div class="form-group">
                        <label for="incomeCurrency">Mƒõna</label>
                        <select id="incomeCurrency">
                            <option value="CZK" selected>CZK</option>
                            <option value="EUR">EUR</option>
                            <option value="USD">USD</option>
                            <option value="GBP">GBP</option>
                            <option value="THB">THB</option>
                            <option value="PLN">PLN</option>
                        </select>
                    </div>

                    <div id="incomeCurrencyNote" class="currency-note hidden">
                        <span id="incomeCurrencyConversion"></span>
                    </div>

                    <div class="form-row">
                        <div class="form-group flex-1">
                            <label for="incomeDate">Datum</label>
                            <input type="date" id="incomeDate" required>
                        </div>
                        <div class="form-group flex-1">
                            <label for="incomeTime">ƒåas</label>
                            <input type="time" id="incomeTime" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="incomeRecipient">Komu</label>
                        <select id="incomeRecipient" required>
                            <option value="">Vyber osobu</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="incomeNote">Pozn√°mka (voliteln√©)</label>
                        <textarea id="incomeNote" placeholder="Dodateƒçn√© informace..." rows="2"></textarea>
                    </div>

                    <button type="submit" class="btn-primary btn-income">
                        <span class="btn-icon">üíµ</span>
                        P≈ôidat p≈ô√≠jem
                    </button>
                </form>
            </div>

            <!-- Expenses List Tab -->
            <div id="expensesTab" class="tab-content">
                <div class="filter-bar">
                    <select id="filterType" class="filter-select">
                        <option value="all">V≈°e</option>
                        <option value="expense">Pouze v√Ωdaje</option>
                        <option value="income">Pouze p≈ô√≠jmy</option>
                    </select>
                    <select id="filterCategory" class="filter-select">
                        <option value="all">V≈°echny kategorie</option>
                    </select>
                </div>
                <div id="expensesList" class="expenses-list">
                    <p class="empty-state">Zat√≠m ≈æ√°dn√© transakce</p>
                </div>
            </div>

            <!-- Balance Tab -->
            <div id="balanceTab" class="tab-content">
                <div class="balance-summary">
                    <div class="summary-card">
                        <div class="summary-label">Celkov√© v√Ωdaje</div>
                        <div class="summary-value" id="totalExpenses">0 Kƒç</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">Celkov√© p≈ô√≠jmy</div>
                        <div class="summary-value income-color" id="totalIncomes">0 Kƒç</div>
                    </div>
                </div>

                <div class="section-header">
                    <h3>üí≥ Bilance ƒçlen≈Ø</h3>
                </div>
                <div id="balanceList" class="balance-list">
                    <p class="empty-state">Zat√≠m ≈æ√°dn√© dluhy</p>
                </div>

                <div class="section-header">
                    <h3>üí∏ Vyrovn√°n√≠ dluh≈Ø</h3>
                </div>
                <div id="settlementList" class="settlement-list">
                    <p class="empty-state">V≈°echno je vyrovnan√©! üéâ</p>
                </div>
            </div>

            <!-- Invitations Tab -->
            <div id="invitationsTab" class="tab-content">
                <div class="section-header">
                    <h2>üì¨ Pozv√°nky do skupin</h2>
                </div>
                <div id="invitationsList" class="invitations-list">
                    <p class="empty-state">≈Ω√°dn√© ƒçekaj√≠c√≠ pozv√°nky</p>
                </div>
            </div>

            <!-- Statistics Tab -->
            <div id="statsTab" class="tab-content">
                <div class="stats-header">
                    <h2>üìä Statistiky</h2>
                    <select id="statsTimeRange" class="filter-select">
                        <option value="all">Celkem</option>
                        <option value="month">Tento mƒõs√≠c</option>
                        <option value="week">Tento t√Ωden</option>
                    </select>
                </div>

                <div class="chart-container">
                    <h3>V√Ωdaje podle kategori√≠</h3>
                    <canvas id="categoryChart"></canvas>
                </div>

                <div class="chart-container">
                    <h3>ƒåasov√Ω v√Ωvoj</h3>
                    <canvas id="timelineChart"></canvas>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-value" id="avgExpense">0 Kƒç</div>
                        <div class="stat-label">Pr≈Ømƒõrn√Ω v√Ωdaj</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üèÜ</div>
                        <div class="stat-value" id="topCategory">-</div>
                        <div class="stat-label">Top kategorie</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üë§</div>
                        <div class="stat-value" id="topSpender">-</div>
                        <div class="stat-label">Nejv√≠ce utratil</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìÖ</div>
                        <div class="stat-value" id="expenseCount">0</div>
                        <div class="stat-label">Poƒçet v√Ωdaj≈Ø</div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-content">
                <div class="settings">
                    
                    <div class="settings-section">
                        <h3>üë§ √öƒçet</h3>
                        <div class="user-info">
                            <div class="user-avatar" id="userAvatar"></div>
                            <div class="user-details">
                                <div class="user-name" id="userName">Naƒç√≠t√°m...</div>
                                <div class="user-email" id="userEmail"></div>
                            </div>
                        </div>
                        <button id="logoutBtnSettings" class="btn-secondary">Odhl√°sit se</button>
                    </div>

                    <div class="settings-section">
                        <h3>üè¢ Organizace</h3>
                        <div class="org-info">
                            <div class="org-name">FAMILY</div>
                            <div id="orgMembersCount" class="org-members">Naƒç√≠t√°m...</div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>üë• Spr√°va aktu√°ln√≠ skupiny</h3>
                        <div id="currentGroupManagement">
                            <p class="empty-state">Vyber skupinu</p>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>üè∑Ô∏è Kategorie v√Ωdaj≈Ø</h3>
                        <div id="categoriesList" class="categories-list"></div>
                        <div class="add-category">
                            <input type="text" id="newCategoryName" placeholder="N√°zev kategorie">
                            <input type="text" id="newCategoryIcon" placeholder="Emoji" maxlength="2" style="width: 60px;">
                            <button id="addCategory" class="btn-secondary">P≈ôidat</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>üë• √öƒçastn√≠ci skupiny</h3>
                        <div id="membersList" class="members-list"></div>
                        <div class="add-member">
                            <input type="text" id="newMember" placeholder="Jm√©no nov√©ho √∫ƒçastn√≠ka">
                            <button id="addMember" class="btn-secondary">P≈ôidat</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>‚òÅÔ∏è Google Apps Script URL</h3>
                        <div class="form-group">
                            <label for="scriptUrl">URL Apps Script</label>
                            <input type="text" id="scriptUrl" placeholder="https://script.google.com/macros/s/...">
                            <small>Po vytvo≈ôen√≠ Apps Scriptu vlo≈æ sem jeho URL</small>
                        </div>
                        <button id="saveScriptUrl" class="btn-primary">Ulo≈æit URL</button>
                        <button id="testScript" class="btn-secondary">Test p≈ôipojen√≠</button>
                    </div>

                    <div class="settings-section">
                        <h3>üóëÔ∏è Data</h3>
                        <button id="clearGroupData" class="btn-warning">Smazat data t√©to skupiny</button>
                        <button id="clearAllData" class="btn-danger">Smazat v≈°echna data</button>
                    </div>

                    <div class="settings-section">
                        <h3>‚ÑπÔ∏è O aplikaci</h3>
                        <p><strong>Verze:</strong> 3.0.0 Secure</p>
                        <p><strong>Zabezpeƒçen√≠:</strong> Google OAuth</p>
                        <p><strong>Backend:</strong> Google Apps Script</p>
                        <p>Offline PWA pro profesion√°ln√≠ sledov√°n√≠ skupinov√Ωch financ√≠</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Modals -->
    <div id="groupModal" class="modal hidden">
        <div class="modal-content">
            <h3>Nov√° skupina</h3>
            <div class="form-group">
                <label for="groupName">N√°zev skupiny</label>
                <input type="text" id="groupName" placeholder="Nap≈ô. Thajsko 2025">
            </div>
            <div class="modal-actions">
                <button id="cancelGroup" class="btn-secondary">Zru≈°it</button>
                <button id="saveGroup" class="btn-primary">Vytvo≈ôit</button>
            </div>
        </div>
    </div>

    
    <!-- Floating Action Button -->
    <button id="fabBtn" class="fab" style="display:none;" title="P≈ôidat v√Ωdaj">‚ûï</button>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="auth.js"></script>
    <script src="db.js"></script>
    <script src="offline.js"></script>
    <script src="app.js"></script>
    <script src="sidebar-module.js"></script>
</body>
</html>
